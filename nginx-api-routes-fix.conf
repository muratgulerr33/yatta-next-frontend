# Nginx Configuration Update - Next.js API Routes
# Bu ayarlar /etc/nginx/sites-enabled/yatta.com.tr dosyasına eklenmeli
# ÖNEMLİ: /api/ location'ından ÖNCE eklenmeli (Nginx location önceliği)

# Next.js API routes için özel location (Nginx'in /api/ location'ından ÖNCE kontrol edilmeli)
# Bu location Next.js'in kendi API route'larını handle etmesi için
location ~ ^/api/(health|test)$ {
    proxy_pass http://127.0.0.1:3000;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # API route'ları için JSON content type
    proxy_set_header Accept application/json;
}

# Backend API istekleri (Next.js API route'larından SONRA)
# Bu location tüm /api/ isteklerini backend'e yönlendirir
# Ancak yukarıdaki regex ile eşleşenler Next.js'e gider
location /api/ {
    proxy_pass https://api.yatta.com.tr/;
    proxy_http_version 1.1;
    proxy_set_header Host api.yatta.com.tr;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

